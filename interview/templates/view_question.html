{% extends 'interview-student-base.html' %}
{% load static %}
{% block head %}
  <title>Dashboard</title>
  <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
    <style>
        body{
            color: white;
        }
    </style>
{% endblock %}
{% block body %}
<div class="view-question container my-5">
    <h3 class="text-center">Feedback</h3>
    <p>As part of the continuous improvement of our services, your feedback is highly appreciated. Your opinions and suggestions are an integral part of our growth and development as an institution.</p>

    <div class="question-section my-5">
        {% if not question.locked %}
            <h4 class="text-center">{{ question.text }}</h4>
        {% endif %}

        {% for feedback in feedbacks %}
            <div class="feedback-box" style="color: white">
                <h5>{{ feedback.sender }}'s Feedback</h5>
                <div id="feedbackArea-{{ student.receiver}}">
                    {{feedback.text}}
                </div>
            </div>
        {% endfor %}
    </div>
</div>
<div class="new-feedback my-5">
    <form id="addFeedbackForm" method="POST" action="{% url 'add_feedback' live_class_info.id %}">
        {% csrf_token %}
        <input type="hidden" name="author" value="{{ request.user.username }}">
        <input type="hidden" name="receiver" value="{{ receiver_username }}">
        <input type="hidden" name="question_id" value="{{ question.id }}">
        <textarea name="content"></textarea>
        <button type="submit">Submit Feedback</button>
    </form>
</div>
<!-- This is the fullscreen div that will be toggled. -->
<div id="fullscreenDiv" class="fullscreen-view"></div>

<script>
  // Assuming jQuery is available
  $(document).ready(function(){
    // Extract the students_feedbacks dict from the script tag
    var students_feedbacks = JSON.parse(document.getElementById('feedbacks').textContent);

    // For each student, load their feedbacks
    for (var student in students_feedbacks) {
      var feedbacks = students_feedbacks[student];
      for (var i = 0; i < feedbacks.length; i++) {
        var feedback = feedbacks[i];
        $('#feedbackArea-' + student).append('<p>' + feedback + '</p>');
      }
    }
  });
</script>

<script id="feedbacks" type="application/json">
  {{ students_feedbacks|safe }}
</script>



{% endblock %}
